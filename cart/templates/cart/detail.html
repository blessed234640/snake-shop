{% extends "shop/base.html" %} {% load static %} {% block title %} –ö–æ—Ä–∑–∏–Ω–∞
–ø–æ–∫—É–ø–æ–∫ - Snake Paradise {% endblock %} {% block content %}
<div class="cart-container">
    <h1>üõí –ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–∫—É–ø–æ–∫</h1>

    {% if cart %}
    <div class="cart">
        <table>
            <thead>
                <tr>
                    <th>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</th>
                    <th>–¢–æ–≤–∞—Ä</th>
                    <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                    <th>–£–¥–∞–ª–∏—Ç—å</th>
                    <th>–¶–µ–Ω–∞ –∑–∞ —à—Ç.</th>
                    <th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
                </tr>
            </thead>
            <tbody>
                {% for item in cart %} {% with product=item.product %}
                <tr>
                    <td>
                        <a href="{{ product.get_absolute_url }}">
                            <img
                                src="{% if product.image %}{{ product.image.url }}{% else %}{% static 'shop/img/no_image.png' %}{% endif %}"
                                alt="{{ product.name }}"
                            />
                        </a>
                    </td>
                    <td>
                        <a
                            href="{{ product.get_absolute_url }}"
                            style="color: var(--text-primary); font-weight: 500"
                        >
                            {{ product.name }}
                        </a>
                    </td>
                    <td>
                        <form
                            action="{% url 'cart:cart_add' product.id %}"
                            method="post"
                            class="quantity-form"
                        >
                            {{ item.update_quantity_form.quantity }}
                            <input
                                type="submit"
                                value="–û–±–Ω–æ–≤–∏—Ç—å"
                                class="button light"
                                style="padding: 8px 16px"
                            />
                            {% csrf_token %}
                        </form>
                    </td>
                    <td>
                        <form
                            action="{% url 'cart:cart_remove' product.id %}"
                            method="post"
                        >
                            <input
                                type="submit"
                                value="üóë –£–¥–∞–ª–∏—Ç—å"
                                class="button"
                                style="background: #dc3545; padding: 8px 16px"
                            />
                            {% csrf_token %}
                        </form>
                    </td>
                    <td class="num">‚ÇΩ{{ item.price }}</td>
                    <td class="num">‚ÇΩ{{ item.total_price }}</td>
                </tr>
                {% endwith %} {% endfor %} {% if cart.coupon %}
                <tr class="subtotal">
                    <td>–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –∏—Ç–æ–≥</td>
                    <td colspan="4"></td>
                    <td class="num">
                        ‚ÇΩ{{ cart.get_total_price|floatformat:2 }}
                    </td>
                </tr>
                <tr>
                    <td>
                        –ö—É–ø–æ–Ω"{{cart.coupon.code}}"(—Å–∫–∏–¥–∫–∞{{cart.coupon.discount}}%)
                    </td>
                    <td colspan="4"></td>
                    <td class="num neg">
                        - ‚ÇΩ{{ cart.get_discount|floatformat:2 }}
                    </td>
                </tr>
                {% endif %}

                <tr class="total">
                    <td colspan="5"><strong>–ò—Ç–æ–≥–æ</strong></td>
                    <td class="num">
                        <strong
                            >‚ÇΩ{{cart.get_total_price_after_discount|floatformat:2}}</strong
                        >
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- –ë–ª–æ–∫ —Å –∫—É–ø–æ–Ω–æ–º -->
    <div
        class="coupon-section"
        style="
            margin: 2rem 0;
            padding: 1.5rem;
            background: var(--bg-card);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
        "
    >
        <h3 style="color: var(--accent-primary); margin-bottom: 1rem">
            –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫—É–ø–æ–Ω:
        </h3>
        <form
            action="{% url 'coupons:apply' %}"
            method="post"
            style="display: flex; gap: 1rem; align-items: flex-end"
        >
            {{ coupon_apply_form }}
            <input
                type="submit"
                value="–ü—Ä–∏–º–µ–Ω–∏—Ç—å"
                class="button light"
                style="padding: 10px 20px"
            />
            {% csrf_token %}
        </form>
    </div>

    <!-- –ë–ª–æ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π -->
    {% if recommended_products %}
    <div
        class="recommendations-section"
        style="
            margin: 2rem 0;
            padding: 2rem;
            background: var(--bg-card);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
        "
    >
        <h3
            style="
                color: var(--accent-primary);
                margin-bottom: 1.5rem;
                text-align: center;
            "
        >
            üêç –° —ç—Ç–∏–º —Ç–∞–∫–∂–µ –ø–æ–∫—É–ø–∞—é—Ç
        </h3>
        <div
            class="recommendations-grid"
            style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1.5rem;
                margin-top: 1rem;
            "
        >
            {% for p in recommended_products %}
            <div
                class="recommended-item"
                style="
                    background: var(--bg-header);
                    border-radius: var(--border-radius);
                    padding: 1.2rem;
                    border: 1px solid var(--border-color);
                    transition: var(--transition);
                    text-align: center;
                "
            >
                <a
                    href="{{ p.get_absolute_url }}"
                    style="
                        text-decoration: none;
                        color: inherit;
                        display: block;
                    "
                >
                    <div
                        style="
                            width: 120px;
                            height: 120px;
                            margin: 0 auto 1rem;
                            border-radius: 10px;
                            overflow: hidden;
                            border: 1px solid var(--border-light);
                        "
                    >
                        <img
                            src="{% if p.image %}{{ p.image.url }}{% else %}{% static 'shop/img/no_image.png' %}{% endif %}"
                            alt="{{ p.name }}"
                            style="
                                width: 100%;
                                height: 100%;
                                object-fit: cover;
                                transition: var(--transition);
                            "
                        />
                    </div>
                    <p
                        style="
                            font-weight: 500;
                            color: var(--text-primary);
                            margin: 0 0 0.5rem;
                            font-size: 0.95rem;
                            line-height: 1.3;
                            min-height: 2.6rem;
                        "
                    >
                        {{ p.name }}
                    </p>
                    <p
                        style="
                            color: var(--accent-primary);
                            font-weight: 600;
                            margin: 0.5rem 0;
                            font-size: 1.1rem;
                        "
                    >
                        ‚ÇΩ{{ p.price }}
                    </p>
                </a>
                <!-- –§–æ—Ä–º–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É -->
                <form
                    action="{% url 'cart:cart_add' p.id %}"
                    method="post"
                    class="add-to-cart-form"
                    style="margin: 0"
                >
                    {% csrf_token %}
                    <input type="hidden" name="quantity" value="1" />
                    <input type="hidden" name="override" value="False" />
                    <button
                        type="submit"
                        style="
                            background: var(--accent-primary);
                            color: var(--bg-dark);
                            border: none;
                            padding: 0.6rem 1.2rem;
                            border-radius: 6px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: var(--transition);
                            font-size: 0.9rem;
                            width: 100%;
                        "
                        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0, 212, 170, 0.3)';"
                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';"
                    >
                        + –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
                    </button>
                </form>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
    <div class="cart-actions">
        <a href="{% url 'shop:product_list' %}" class="button light">
            ‚Üê –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∫—É–ø–∫–∏
        </a>
        <a href="{% url 'orders:order_create' %}" class="button">
            üêç –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ ‚Üí
        </a>
    </div>
    {% else %}
    <div
        style="
            text-align: center;
            padding: 3rem;
            background: var(--bg-card);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
        "
    >
        <h2 style="color: var(--text-secondary); margin-bottom: 1rem">
            –í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞
        </h2>
        <p style="color: var(--text-secondary); margin-bottom: 2rem">
            –û—Ç–∫—Ä–æ–π—Ç–µ –¥–ª—è —Å–µ–±—è –Ω–∞—à—É —É–¥–∏–≤–∏—Ç–µ–ª—å–Ω—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é –∑–º–µ–π!
        </p>
        <a href="{% url 'shop:product_list' %}" class="button">
            –°–º–æ—Ç—Ä–µ—Ç—å –∫–∞—Ç–∞–ª–æ–≥
        </a>
    </div>
    {% endif %}
</div>

<style>
    .recommended-item:hover {
        transform: translateY(-5px);
        border-color: var(--accent-primary);
        box-shadow: var(--glow);
    }

    .recommended-item:hover img {
        transform: scale(1.05);
    }

    .add-to-cart-form button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 212, 170, 0.3);
    }

    @media (max-width: 768px) {
        .recommendations-grid {
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .recommended-item {
            padding: 1rem;
        }
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É
        const addToCartForms = document.querySelectorAll(".add-to-cart-form");

        addToCartForms.forEach((form) => {
            form.addEventListener("submit", function (e) {
                e.preventDefault();

                const button = this.querySelector("button");
                const originalText = button.textContent;

                // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
                button.textContent = "‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ!";
                button.style.background = "#28a745";
                button.disabled = true;

                // –ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
                setTimeout(() => {
                    this.submit();
                }, 800);
            });
        });

        // –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
        const recommendedItems = document.querySelectorAll(".recommended-item");
        recommendedItems.forEach((item) => {
            item.addEventListener("mouseenter", function () {
                this.style.transform = "translateY(-5px)";
                this.style.borderColor = "var(--accent-primary)";
                this.style.boxShadow = "var(--glow)";
                const img = this.querySelector("img");
                if (img) img.style.transform = "scale(1.05)";
            });

            item.addEventListener("mouseleave", function () {
                this.style.transform = "translateY(0)";
                this.style.borderColor = "var(--border-color)";
                this.style.boxShadow = "none";
                const img = this.querySelector("img");
                if (img) img.style.transform = "scale(1)";
            });
        });
    });
</script>
{% endblock %}
