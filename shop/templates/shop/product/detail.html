{% extends "shop/base.html" %} 
{% load i18n static %} 
{% load currency_tags %}

{% block title %}
  {{ product.name }} - {% translate "Snake Paradise" %}
{% endblock %} 

{% block content %}
<div class="product-detail">
    <!-- –ì–∞–ª–µ—Ä–µ—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
    <div class="product-gallery">
        <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ -->
        <div class="main-image">
            <img
                id="mainProductImage"
                src="{% if product.image %}{{ product.image.url }}{% else %}{% static 'shop/img/no_image.png' %}{% endif %}"
                alt="{{ product.name }}"
            />
        </div>

        <!-- –ú–∏–Ω–∏–∞—Ç—é—Ä—ã –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
        {% if additional_images %}
        <div class="image-thumbnails">
            {% for image in additional_images %}
            <div
                class="thumbnail"
                onclick="changeImage('{{ image.image.url }}', this)"
            >
                <img src="{{ image.image.url }}" alt="{{ product.name }}" />
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>

    <div class="product-info">
        <h1>{{ product.name }}</h1>
        <h2 style="color: var(--text-secondary); margin: 1rem 0">
            üìÅ {% translate "Category" %}:
            <a
                href="{{ product.category.get_absolute_url }}"
                style="color: var(--accent-primary)"
            >
                {{ product.category }}
            </a>
        </h2>

        <div class="price">{{ product.price|currency }}</div>

        <form
            action="{% url 'cart:cart_add' product.id %}"
            method="post"
            style="margin: 2.5rem 0"
        >
            <div style="margin-bottom: 1.5rem">{{ cart_product_form }}</div>
            {% csrf_token %}
            <input type="submit" value='üõí {% translate "Add to cart" %}' class="button" />
        </form>

        <div class="product-description">
            <h3 style="color: var(--accent-primary); margin-bottom: 1rem">
                üìù {% translate "Description" %}
            </h3>
            <div style="color: var(--text-secondary); line-height: 1.8">
                {{ product.description|linebreaks }}
            </div>
        </div>

        <!-- –ë–ª–æ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π -->
        {% if recommended_products %}
        <div
            class="recommendations-section"
            style="
                margin-top: 3rem;
                padding-top: 2rem;
                border-top: 1px solid var(--border-color);
            "
        >
            <h3
                style="
                    color: var(--accent-primary);
                    margin-bottom: 1.5rem;
                    text-align: center;
                "
            >
                üêç {% translate "People who bought this also bought" %}
            </h3>
            <div
                class="recommendations-grid"
                style="
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                    gap: 1.5rem;
                    margin-top: 1rem;
                "
            >
                {% for p in recommended_products %}
                <div
                    class="recommended-item"
                    style="
                        background: var(--bg-card);
                        border-radius: var(--border-radius);
                        padding: 1rem;
                        border: 1px solid var(--border-color);
                        transition: var(--transition);
                        text-align: center;
                    "
                >
                    <a
                        href="{{ p.get_absolute_url }}"
                        style="text-decoration: none; color: inherit"
                    >
                        <div
                            style="
                                width: 100px;
                                height: 100px;
                                margin: 0 auto 0.8rem;
                                border-radius: 8px;
                                overflow: hidden;
                                border: 1px solid var(--border-color);
                            "
                        >
                            <img
                                src="{% if p.image %}{{ p.image.url }}{% else %}{% static 'shop/img/no_image.png' %}{% endif %}"
                                alt="{{ p.name }}"
                                style="
                                    width: 100%;
                                    height: 100%;
                                    object-fit: cover;
                                    transition: var(--transition);
                                "
                            />
                        </div>
                        <p
                            style="
                                font-weight: 500;
                                color: var(--text-primary);
                                margin: 0;
                                font-size: 0.9rem;
                                line-height: 1.3;
                            "
                        >
                            {{ p.name }}
                        </p>
                        <p style="color: var(--accent-primary); font-weight: 600; margin: 0.3rem 0 0; font-size: 0.9rem;">
                            {{ p.price|currency }}
                        </p>
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block domready %}
<script>
    function changeImage(imageUrl, element) {
        // –ú–µ–Ω—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        const mainImage = document.getElementById("mainProductImage");
        mainImage.src = imageUrl;

        // –ü–ª–∞–≤–Ω–∞—è —Å–º–µ–Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        mainImage.style.opacity = "0";
        setTimeout(() => {
            mainImage.style.opacity = "1";
        }, 150);

        // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –º–∏–Ω–∏–∞—Ç—é—Ä
        const thumbnails = document.querySelectorAll(".thumbnail");
        thumbnails.forEach((thumb) => {
            thumb.classList.remove("active");
        });

        // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –º–∏–Ω–∏–∞—Ç—é—Ä–µ
        element.classList.add("active");
    }

    // –ü–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    document.addEventListener("DOMContentLoaded", function () {
        const mainImage = document.getElementById("mainProductImage");
        mainImage.style.transition = "opacity 0.3s ease";

        // –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
        const recommendedItems = document.querySelectorAll(".recommended-item");
        recommendedItems.forEach((item) => {
            item.addEventListener("mouseenter", function () {
                this.style.transform = "translateY(-5px)";
                this.style.borderColor = "var(--accent-primary)";
                this.style.boxShadow = "var(--glow)";
                const img = this.querySelector("img");
                img.style.transform = "scale(1.05)";
            });

            item.addEventListener("mouseleave", function () {
                this.style.transform = "translateY(0)";
                this.style.borderColor = "var(--border-color)";
                this.style.boxShadow = "none";
                const img = this.querySelector("img");
                img.style.transform = "scale(1)";
            });
        });
    });
</script>
{% endblock %}